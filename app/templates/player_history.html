{% extends 'base.html' %}
{% block title %}Player History{% endblock %}

{% block content %}
<h3>üìä Season History ‚Äî {{ player.name }}</h3>

<div class="row mb-4">
  <div class="col-md-6">
    <div class="card text-center border-success">
      <div class="card-body">
        <h5 class="card-title">üèÄ Games Played</h5>
        <p class="display-5">{{ total_games }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card text-center border-primary">
      <div class="card-body">
        <h5 class="card-title">üìÖ Practices Attended</h5>
        <p class="display-5">{{ total_practices }}</p>
      </div>
    </div>
  </div>
</div>

<!-- üü¶ Bar Chart -->
<canvas id="historyChart" class="mb-4"></canvas>

<!-- üß† Season Stats Table -->
<div class="card">
  <div class="card-header fw-bold">Seasonal Evaluations</div>
  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead class="table-light">
        <tr>
          <th>Season</th>
          <th>Behavior</th>
          <th>Technical Skills</th>
          <th>Team Relation</th>
          <th>Improvement Areas</th>
          <th>Height (cm)</th>
          <th>Weight (kg)</th>
        </tr>
      </thead>
      <tbody>
        {% for s in stats_entries %}
        <tr>
          <td>{{ s.season.name }}</td>
          <td>{{ s.behavior or '-' }}</td>
          <td>{{ s.technical_skills or '-' }}</td>
          <td>{{ s.team_relation or '-' }}</td>
          <td>{{ s.improvement_areas or '-' }}</td>
          <td>{{ s.height_cm or '-' }}</td>
          <td>{{ s.weight_kg or '-' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<a href="{{ url_for('players.manage_players') }}" class="btn btn-secondary mt-3">‚Üê Back to Players</a>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('historyChart').getContext('2d');
const chart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: ['Games Played', 'Practices Attended'],
    datasets: [{
      label: '{{ player.name }}',
      data: [{{ total_games }}, {{ total_practices }}],
      backgroundColor: ['#0d6efd', '#198754'],
      borderRadius: 5
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      title: { display: true, text: 'Participation Summary' }
    },
    scales: {
      y: { beginAtZero: true }
    }
  }
});
</script>
{% endblock %}