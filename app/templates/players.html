{% extends 'base.html' %}
{% block title %}Team Roster – Team Manager{% endblock %}

{% block content %}
<div class="card mx-auto" style="max-width: 1000px;">
  <!-- Accordion Toggle Header -->
  <div class="card-header d-flex justify-content-between align-items-center"
       style="cursor: pointer; background-color: #f4ede4; color: #343a40; font-weight: bold;"
       onclick="toggleForm()">
    <span>➕ Add New Player</span>
    <span id="toggleIcon">▼</span>
  </div>

  <!-- Toggleable Form -->
  <div id="playerForm" class="card-body {% if not open_form %}d-none{% endif %}">
    <form method="post" class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Season Year</label>
        <input name="season_year" class="form-control" required>
      </div>

      <div class="col-md-4">
        <label class="form-label">Name</label>
        <input name="name" class="form-control" required>
      </div>

      <div class="col-md-4">
        <label class="form-label">Escalão</label>
        <input name="escalao" class="form-control" required>
      </div>

      <div class="col-md-4">
        <label class="form-label">Nº Carteira</label>
        <input name="n_carteira" class="form-control" required>
      </div>

      <div class="col-md-4">
        <label class="form-label">Date of Birth</label>
        <input type="date" name="dob" class="form-control" required>
      </div>

      <div class="col-md-4">
        <label class="form-label">Mobile Phone</label>
        <input name="mobile_phone" class="form-control">
      </div>

      <div class="col-md-6">
        <label class="form-label">Email</label>
        <input type="email" name="email" class="form-control">
      </div>

      <div class="col-12 d-grid gap-2 d-md-flex justify-content-md-end">
        <button type="submit" class="btn btn-success">➕ Add Player</button>
      </div>
    </form>
  </div>
</div>

<!-- Divider -->
<hr class="my-4">

<!-- Team Roster -->
<h2 class="mt-4">📋 Team Roster</h2>

<div class="table-responsive">
  <table class="table table-striped table-bordered mt-3 align-middle text-center">
    <thead class="table-dark">
      <tr>
        <th>Name</th>
        <th>Escalão</th>
        <th>Carteira</th>
        <th>DOB</th>
        <th>Phone</th>
        <th>Email</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for player in players %}
        <tr>
          <td>{{ player.name }}</td>
          <td>{{ player.escalao }}</td>
          <td>{{ player.n_carteira }}</td>
          <td>{{ player.dob }}</td>
          <td>{{ player.mobile_phone }}</td>
          <td>{{ player.email }}</td>
          <td class="text-nowrap">
            <a href="{{ url_for('players.edit_player', player_id=player.id) }}" class="btn btn-sm btn-outline-warning">✏️ Edit</a>
            <form action="{{ url_for('players.delete_player', player_id=player.id) }}" method="POST" class="d-inline">
              <button type="submit" class="btn btn-sm btn-outline-danger mb-1"
                onclick="return confirm('Are you sure you want to delete this player?');">
                🗑 Delete
              </button>
            </form>
            <a href="{{ url_for('players.player_season_stats', player_id=player.id) }}" class="btn btn-sm btn-outline-info mb-1">
              📊 Stats
            </a>
            <a href="{{ url_for('players.player_history', player_id=player.id) }}" class="btn btn-sm btn-outline-dark mb-1">
              📈 History
            </a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block js %}
<script>
  function toggleForm() {
    const form = document.getElementById('playerForm');
    const icon = document.getElementById('toggleIcon');
    const isHidden = form.classList.contains('d-none');

    form.classList.toggle('d-none');
    icon.innerText = isHidden ? '▼' : '➕';
  }

  window.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('playerForm');
    const icon = document.getElementById('toggleIcon');
    if (!form.classList.contains('d-none')) {
      icon.innerText = '▼';
    }
  });
</script>
{% endblock %}